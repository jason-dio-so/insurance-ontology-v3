\*\*생성일\*\*: 2025-12-14

\*\*목표\*\*: Phase 7 테이블(plan, risk_event, exclusion)에 실제 데이터
연동

──────────────────────────────────────────────────

# 현재 상태

  ---------------------------------------------------------------------------------
  테이블          PostgreSQL     graph_loader.py      Neo4j          데이터
  --------------- -------------- -------------------- -------------- --------------
  plan            ✅ 스키마 있음 ✅ sync_plans()      ✅ 검증 완료   ✅ 10건

  plan_coverage   ✅ 스키마 있음 ✅ 포함됨            ✅ 검증 완료   ✅ 1,086건

  risk_event      ✅ 스키마 있음 ✅                   ✅ 검증 완료   ✅ 572건
                                 sync_risk_events()                  

  exclusion       ✅ 스키마 있음 ✅ sync_exclusions() ✅ 검증 완료   ✅ 28건

  condition       ✅ 스키마 있음 ✅ sync_conditions() ✅ 검증 완료   ✅ 42건
  ---------------------------------------------------------------------------------

──────────────────────────────────────────────────

# Task 1: Plan 테이블 연동 (중요도: 높음)

## 데이터 소스

- proposal (가입설계서) 10건

- proposal 문서에서 \`table_row\` 690건 추출됨

- \`structured_data\`에 coverage_name, coverage_amount, premium 있음

## 현재 상황

- Plan 레벨 메타데이터(성별, 나이, 납입기간 등)는 아직 추출 안됨

## 필요 작업

### \[A\] proposal_plan_extractor.py 신규 작성 ✅ 완료

  -----------------------------------------------------------------------
  단계                    작업                    상태
  ----------------------- ----------------------- -----------------------
  A.1                     PDF 헤더/메타데이터에서 ✅
                          Plan 정보 추출          

  A.2                     plan 테이블에 INSERT    ✅

  A.3                     기존 document_clause의  ✅
                          coverage와 연결하여     
                          plan_coverage 테이블    
                          생성                    
  -----------------------------------------------------------------------

\*\*추출 대상 필드:\*\*

- target_gender (피보험자 성별)

- target_age (가입 나이)

- insurance_period (보험기간)

- payment_period (납입기간)

- total_premium (합계 보험료)

### \[B\] ingest_v3.py 수정

  -----------------------------------------------------------------------
  단계                    작업                    상태
  ----------------------- ----------------------- -----------------------
  B.1                     TableParser에서 Plan    ⬜
                          메타데이터 추출 로직    
                          추가                    

  -----------------------------------------------------------------------

## 예상 작업량

약 2-3일

──────────────────────────────────────────────────

# Task 2: RiskEvent 테이블 연동 (중요도: 중간) ✅ 완료

## 데이터 소스

- terms (약관) 9건, 129,667 articles

## 현재 상황

- ✅ 572개 RiskEvent 추출 및 Neo4j 동기화 완료

## 필요 작업

### \[A\] risk_event_extractor.py 신규 작성 ✅ 완료

  -----------------------------------------------------------------------
  단계                    작업                    상태
  ----------------------- ----------------------- -----------------------
  A.1                     terms 문서에서 패턴     ✅
                          매칭으로 위험 이벤트    
                          추출                    

  A.2                     risk_event 테이블에     ✅
                          INSERT                  

  A.3                     benefit과 연결하여      ⬜ (추후)
                          benefit_risk_event 생성 
  -----------------------------------------------------------------------

\*\*추출 결과:\*\*

  -----------------------------------------------------------------------
  event_type                          건수
  ----------------------------------- -----------------------------------
  cancer                              220

  treatment                           106

  hospitalization                     84

  cerebrovascular                     75

  injury                              54

  cardiovascular                      33
  -----------------------------------------------------------------------

\*\*추출 패턴:\*\*

- clause_title에서 \"정의\" 패턴 매칭

- ICD 코드 패턴 (C73, C44, I63, I21 등) 추출

## 예상 작업량

\~\~약 3-5일\~\~ → 완료

──────────────────────────────────────────────────

# Task 3: Exclusion 테이블 연동 (중요도: 중간) ✅ 완료

## 데이터 소스

- terms (약관) 9건

- \"보험금을 지급하지 않는 사유\" 조항들

## 현재 상황

- ✅ 28개 Exclusion 추출 및 Neo4j 동기화 완료

## 필요 작업

### \[A\] exclusion_extractor.py 신규 작성 ✅ 완료

  -----------------------------------------------------------------------
  단계                    작업                    상태
  ----------------------- ----------------------- -----------------------
  A.1                     terms 문서에서          ✅
                          면책/미지급 조항 추출   

  A.2                     coverage_id 연결        ✅
                          (clause_coverage 테이블 
                          활용)                   

  A.3                     exclusion 테이블에      ✅
                          INSERT                  

  A.4                     Neo4j 동기화            ✅
  -----------------------------------------------------------------------

\*\*추출 결과:\*\*

  -----------------------------------------------------------------------
  exclusion_type                      건수
  ----------------------------------- -----------------------------------
  general                             23

  conditional                         4

  absolute                            1
  -----------------------------------------------------------------------

\*\*참고:\*\* clause_coverage 테이블에 연결된 면책 조항만 추출 (43건 중
28건)

## 예상 작업량

\~\~약 2-3일\~\~ → 완료

──────────────────────────────────────────────────

# Task 4: Condition 테이블 연동 (중요도: 중간) ✅ 완료

## 데이터 소스

- terms (약관) 9건

- \"보장개시\", \"면책기간\", \"가입조건\" 조항들

## 현재 상황

- ✅ 42개 Condition 추출 및 Neo4j 동기화 완료

## 필요 작업

### \[A\] condition_extractor.py 신규 작성 ✅ 완료

  -----------------------------------------------------------------------
  단계                    작업                    상태
  ----------------------- ----------------------- -----------------------
  A.1                     terms 문서에서 보장조건 ✅
                          조항 추출               

  A.2                     coverage_id 연결        ✅
                          (clause_coverage 테이블 
                          활용)                   

  A.3                     waiting_period_days     ✅
                          추출 (90일 등)          

  A.4                     condition 테이블에      ✅
                          INSERT                  

  A.5                     Neo4j 동기화            ✅
  -----------------------------------------------------------------------

\*\*추출 결과:\*\*

  -----------------------------------------------------------------------
  condition_type          건수                    avg_waiting
  ----------------------- ----------------------- -----------------------
  waiting_period          29                      90일

  general                 13                      90일
  -----------------------------------------------------------------------

## 예상 작업량

\~\~약 2-3일\~\~ → 완료

──────────────────────────────────────────────────

# 우선순위

  -------------------------------------------------------------------------
  순서              작업              상태              이유
  ----------------- ----------------- ----------------- -------------------
  1                 \*\*Plan 추출\*\* ✅ 완료           proposal 문서가
                                                        이미 있고, 구조가
                                                        명확함

  2                 \*\*Plan → Neo4j  ✅ 완료           graph_loader.py에
                    동기화\*\*                          sync_plans() 이미
                                                        있음

  3                 \*\*RiskEvent     ✅ 완료           패턴 매칭으로 572건
                    추출\*\*                            추출

  4                 \*\*Exclusion     ✅ 완료           clause_coverage
                    추출\*\*                            연결 활용하여 28건
                                                        추출

  5                 \*\*Condition     ✅ 완료           보장개시일 90일 등
                    추출\*\*                            42건 추출
  -------------------------------------------------------------------------

──────────────────────────────────────────────────

# 진행 이력

  ----------------------------------------------------------------------------
  날짜                    작업                         결과
  ----------------------- ---------------------------- -----------------------
  2025-12-14              Phase 7 파이프라인 검증      ✅ plan, plan_coverage
                          (테스트 데이터)              → Neo4j 동기화 정상

  2025-12-14              테스트 데이터 삭제           ✅ 완료

  2025-12-14              proposal_plan_extractor.py   ✅ 10개 Plan, 1086개
                          작성                         plan_coverage 생성

  2025-12-14              Neo4j Plan 동기화            ✅ 10 Plans, 564
                                                       INCLUDES 관계 생성

  2025-12-14              risk_event_extractor.py 작성 ✅ 572개 RiskEvent 생성

  2025-12-14              Neo4j RiskEvent 동기화       ✅ 572 RiskEvents 생성

  2025-12-14              exclusion_extractor.py 작성  ✅ 28개 Exclusion 생성

  2025-12-14              Neo4j Exclusion 동기화       ✅ 28 Exclusions, 28
                                                       HAS_EXCLUSION 관계 생성

  2025-12-14              condition_extractor.py 작성  ✅ 42개 Condition 생성

  2025-12-14              Neo4j Condition 동기화       ✅ 42 Conditions, 42
                                                       HAS_CONDITION 관계 생성
  ----------------------------------------------------------------------------

──────────────────────────────────────────────────

# 참고

## plan 테이블 스키마

CREATE TABLE plan (

id SERIAL PRIMARY KEY,

document_id INTEGER REFERENCES document(id),

product_id INTEGER NOT NULL REFERENCES product(id),

variant_id INTEGER REFERENCES product_variant(id),

plan_name VARCHAR(200),

target_gender VARCHAR(10),

target_age INTEGER,

insurance_period VARCHAR(50),

payment_period VARCHAR(50),

payment_cycle VARCHAR(20),

total_premium NUMERIC(15,2),

attributes JSONB,

created_at TIMESTAMP DEFAULT now(),

updated_at TIMESTAMP DEFAULT now()

);

## risk_event 테이블 스키마

CREATE TABLE risk_event (

id SERIAL PRIMARY KEY,

event_type VARCHAR(50) NOT NULL,

event_name VARCHAR(200) NOT NULL,

severity_level VARCHAR(20),

icd_code_pattern VARCHAR(100),

description TEXT,

created_at TIMESTAMP DEFAULT now(),

updated_at TIMESTAMP DEFAULT now()

);

## 현재 proposal structured_data 예시

{

\"premium\": 590,

\"coverage_name\": \"보통약관(상해사망)\",

\"coverage_amount\": 10000000,

\"premium_frequency\": \"월\",

\"coverage_amount_text\": \"1,000만원\"

}
